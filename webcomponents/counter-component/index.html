<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcomponents + Web Worker</title>
    <style>
        html { font-size: 20px; font-family: sans-serif; }
        body { margin: 4rem 2rem; }
        h2 { display: none; font-weight: normal; line-height: 180%; margin: 4rem 2rem; max-width: 800px; }
        h2.active { display: block; }
    </style>
    <script type="module">
        import TextScanner from './text-scanner.js';
        customElements.define('text-scanner', TextScanner);
    </script>
</head>
<body>
    <h1>Web Worker</h1>

    <!--
        The State Of Web Workers In 2021 (Surma), https://www.smashingmagazine.com/2021/06/web-workers-2021/
        When should you be using Web Workers? (Surma), https://surma.dev/things/when-workers/index.html
        Prioritized Task Scheduling, https://wicg.github.io/scheduling-apis/
        Carl Hewitt explains the essence of the Actor Model of computation, https://letitcrash.com/post/20964174345/carl-hewitt-explains-the-essence-of-the-actor
        https://de.wikipedia.org/wiki/Actor_Model

        Jake Archibald: In The Loop - JSConf.Asia, https://www.youtube.com/watch?v=cCOL7MC4Pl0
        Was zum Henker ist √ºberhaupt die Ereignisschleife? | Philip Roberts | JSConf EU, https://www.youtube.com/watch?v=8aGhZQkoFbQ&t=664s
    -->

    <h2>
        <text-scanner>
            <template id="tpl-text-scanner" shadowroot="open">
                <div class="scanner">
                    <div class="scanner__focus">üòé</div>
                </div>
                <style>
                    .scanner { overflow: auto; padding: 8px 0; height: 34px; }
                    .scanner__focus { position: absolute; font-size: 30px; }
                </style>
            </template>
        </text-scanner>
    </h2>
    <h2>Eine wachsende Anzahl und Vielfalt an Endger√§ten in den letzten Jahren erfordert die Beachtung von Ger√§ten mit geringer Leistung.</h2>
    <h2>Lang laufendes JavaSript blockiert den Main Thread f√ºr wichtige Aufgaben in der UI.</h2>
    <h2>Eine blockierte Oberfl√§che wird <a href="https://web.dev/rail/">als st√∂rend wahrgenommen</a> und f√ºhrt zu h√∂herer Abbruchrate.</h2>
    <h2>Code-Splitting und regelm√§√üige Breakpoints im Code helfen nur begrenzt.</h2>
    <h2>Off-Main-Thread Architektur mit Web Workern erh√§lt die Responsiveness der UI.</h2>
    <h2>Eine Worker-freundliche Entwicklung erleichtert den Umstieg zu einem sp√§teren Zeitpunkt.</h2>
    <h2>Beispiel: <a href="./example.html">Webcomponents + Web Worker</a></h2>

    <script type="module">
        const setActive = (index = 0) => {
            headlines.forEach((headline) => {
                headline.classList.remove('active');
            });
            headlines[index].classList.add('active');
        }

        const toggleFullScreen = () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                document.exitFullscreen();
                }
            }
        }

        const headlineNodes = document.querySelectorAll('h2');
        const headlines = Array.from(headlineNodes);
        let index = 0;

        setActive(index);
        window.addEventListener('keyup', (event) => {
            // full screen
            if (event.keyCode == 70 || (document.fullscreenElement && event.keyCode == 27)) {
                toggleFullScreen();
            }
            // paging
            if (event.key === 'ArrowRight' && index<headlines.length-1) {
                index += 1;
                setActive(index);
            } else if (event.key === 'ArrowLeft' && index>0) {
                index -= 1;
                setActive(index);
            }
        });
    </script>
</body>
</html>